<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í¬ì¼“ëª¬ ê´€ë¦¬ í˜ì´ì§€ V2</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 20px;
            background-color: #f2f2f2;
        }
        h1, h2 {
            color: #444;
        }
        .search-box {
            margin-bottom: 20px;
        }
        .search-box input {
            padding: 5px;
            width: 200px;
        }
        .pokemon-list, .battle-area {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .pokemon-card {
            background-color: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 180px;
        }
        .pokemon-card:hover {
            background-color: #e0f7fa;
            cursor: pointer;
        }
        .buttons {
            margin-top: 10px;
        }
        .buttons button {
            margin-right: 5px;
        }
        .battle-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-top: 30px;
        }
        .hp-bar {
            height: 10px;
            background-color: red;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>í¬ì¼“ëª¬ ê´€ë¦¬ í˜ì´ì§€ V2</h1>

    <div class="search-box">
        <input type="text" id="searchId" placeholder="IDë¡œ í¬ì¼“ëª¬ ê²€ìƒ‰">
        <button onclick="searchPokemon()">ê²€ìƒ‰</button>
    </div>

    <h2>í¬ì¼“ëª¬ ëª©ë¡</h2>
    <div class="pokemon-list" id="pokemonList"></div>

    <h2>âš”ï¸ ëŒ€ê²° í˜ì´ì§€</h2>
    <div class="battle-container">
        <div>
            <h3>Attacker</h3>
            <select id="attackerSelect"></select>
        </div>
        <div>
            <h3>Defender</h3>
            <select id="defenderSelect"></select>
        </div>
        <div>
            <button onclick="startBattle()">ê³µê²©!</button>
        </div>
    </div>

    <div class="battle-area" id="battleArea"></div>

    <script>
      const baseUrl = "http://localhost:9001/api/v2/pokemon";

      async function fetchAll() {
        const res = await fetch(baseUrl);
        const data = await res.json();
        renderList(data);
        populateSelectOptions(data);
      }

      function renderList(pokemons) {
        const container = document.getElementById("pokemonList");
        container.innerHTML = "";
        pokemons.forEach(p => {
          const card = document.createElement("div");
          card.className = "pokemon-card";
          card.innerHTML = `
                    <strong>${p.name}</strong><br>
                    ID: ${p.id}<br>
                    HP: ${p.hp}<br>
                    ATK: ${p.attack}<br>
                    DEF: ${p.defense}<br>
                    SPD: ${p.speed}<br>
                    <div class="buttons">
                        <button onclick="deletePokemon(${p.id})">ì‚­ì œ</button>
                        <button onclick="editPokemon(${p.id})">ìˆ˜ì •</button>
                        <button onclick="showDetail(${p.id})">ìƒì„¸</button>
                    </div>
                `;
          container.appendChild(card);
        });
      }

      async function deletePokemon(id) {
        if (!confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) return;
        await fetch(`${baseUrl}/${id}`, { method: "DELETE" });
        fetchAll();
      }

      async function showDetail(id) {
        const res = await fetch(`${baseUrl}/${id}`);
        const p = await res.json();
        alert(`ì´ë¦„: ${p.name}\nHP: ${p.hp}\nê³µê²©ë ¥: ${p.attack}\në°©ì–´ë ¥: ${p.defense}\nì†ë„: ${p.speed}`);
      }

      function editPokemon(id) {
        fetch(`${baseUrl}/${id}`)
          .then(res => res.json())
          .then(pokemon => {
            const newHp = prompt("ìƒˆ HPë¥¼ ì…ë ¥í•˜ì„¸ìš”:", pokemon.hp);
            const newAtk = prompt("ìƒˆ ê³µê²©ë ¥ì„ ì…ë ¥í•˜ì„¸ìš”:", pokemon.attack);
            const newDef = prompt("ìƒˆ ë°©ì–´ë ¥ì„ ì…ë ¥í•˜ì„¸ìš”:", pokemon.defense);
            const newSpd = prompt("ìƒˆ ìŠ¤í”¼ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”:", pokemon.speed);

            if (newHp && newAtk && newDef && newSpd) {
              fetch(`${baseUrl}/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  hp: parseInt(newHp),
                  attack: parseInt(newAtk),
                  defense: parseInt(newDef),
                  speed: parseInt(newSpd)
                })
              }).then(() => fetchAll());
            }
          });
      }

      async function searchPokemon() {
        const id = document.getElementById("searchId").value;
        if (!id) return;
        const res = await fetch(`${baseUrl}/${id}`);
        const p = await res.json();
        alert(`ê²€ìƒ‰ ê²°ê³¼:\nì´ë¦„: ${p.name}\nHP: ${p.hp}`);
      }

      function populateSelectOptions(pokemons) {
        const attackerSelect = document.getElementById("attackerSelect");
        const defenderSelect = document.getElementById("defenderSelect");
        attackerSelect.innerHTML = "";
        defenderSelect.innerHTML = "";

        pokemons.forEach(p => {
          const option1 = document.createElement("option");
          const option2 = document.createElement("option");
          option1.value = p.id;
          option1.textContent = `${p.name} (ID: ${p.id})`;
          option2.value = p.id;
          option2.textContent = `${p.name} (ID: ${p.id})`;
          attackerSelect.appendChild(option1);
          defenderSelect.appendChild(option2);
        });
      }

      async function startBattle() {
        const attackerId = document.getElementById("attackerSelect").value;
        const defenderId = document.getElementById("defenderSelect").value;
        if (attackerId === defenderId) return alert("ì„œë¡œ ë‹¤ë¥¸ í¬ì¼“ëª¬ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");

        await fetch(`${baseUrl}/attack?attackerId=${attackerId}&defenderId=${defenderId}`, { method: "POST" });

        const defender = await fetch(`${baseUrl}/${defenderId}`).then(r => r.json());

        const battleArea = document.getElementById("battleArea");
        battleArea.innerHTML = `
                <div>
                    <strong>ğŸ¯ ê³µê²© ì„±ê³µ!</strong><br>
                    <span>Defender ë‚¨ì€ HP: ${defender.hp}</span>
                    <div class="hp-bar" style="width: ${defender.hp}px;"></div>
                </div>
            `;
        fetchAll();
      }

      window.onload = fetchAll;
    </script>
</body>
</html>